{"data":{"function":{"id":"sfnc_TNhNLzGwpl","workspaceId":"wMBaUuD1kyoxfqKZzLNPN5","displayName":"Lookup Rules","description":"","logoUrl":"https://public-segment-devcenter-production.s3.amazonaws.com/dc327a00-40da-4652-a439-8bcd4179d4e6.png","code":"// Learn more about source functions API at\n// https://segment.com/docs/connections/sources/source-functions\n\n/**\n src tmp Handle incoming HTTP request\n *\n src tmp @param {FunctionRequest} request\n src tmp @param {FunctionSettings} settings\n */\nasync function onRequest(request, settings) {\n\tconst body = request.json();\n\n\tconst endpoint = ''; // replace with your endpoint\n\tlet response;\n\n\ttry {\n\t\tresponse = await fetch(endpoint, {\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\tAuthorization: `Basic ${btoa(settings.apiKey + ':')}`,\n\t\t\t\t'Content-Type': 'application/json'\n\t\t\t},\n\t\t\tbody: JSON.stringify(body)\n\t\t});\n\t} catch (error) {\n\t\t// Retry on connection error\n\t\tthrow new RetryError(error.message);\n\t}\n\n\tif (response.status >= 500 || response.status === 429) {\n\t\t// Retry on 5xx (server errors) and 429s (rate limits)\n\t\tthrow new RetryError(`Failed with ${response.status}`);\n\t}\n\n\t// See https://segment.com/docs/connections/spec/track/\n\tSegment.track({\n\t\tevent: 'Test Event',\n\t\tuserId: 'user_id',\n\t\tproperties: {\n\t\t\ttestProperty: 'testValue',\n\t\t\ttestProperty2: response.propertyName\n\t\t}\n\t});\n\n\t// See https://segment.com/docs/connections/spec/identify/\n\tSegment.identify({\n\t\tuserId: 'user_id',\n\t\ttraits: {\n\t\t\tuserName: 'Unicorn'\n\t\t}\n\t});\n\n\t// See https://segment.com/docs/connections/spec/group/\n\tSegment.group({\n\t\tgroupId: 'group_id',\n\t\tuserId: 'user_id',\n\t\ttraits: {\n\t\t\tgroupName: 'Unicorn'\n\t\t}\n\t});\n\n\t// See https://segment.com/docs/connections/spec/page/\n\tSegment.page({\n\t\tname: 'Home page',\n\t\tuserId: 'user_id',\n\t\tproperties: {\n\t\t\turl: 'https://mywebsite.com/about'\n\t\t}\n\t});\n\n\t// See https://segment.com/docs/connections/spec/screen/\n\tSegment.screen({\n\t\tname: 'Test Screen',\n\t\tuserId: 'user_id',\n\t\tproperties: {\n\t\t\turl: 'https://mywebsite.com/about'\n\t\t}\n\t});\n\n\t// See https://segment.com/docs/connections/sources/catalog/libraries/server/object-api/\n\tSegment.set({\n\t\tcollection: 'users',\n\t\tid: 'user_id',\n\t\tproperties: {\n\t\t\tuserName: 'Unicorn'\n\t\t}\n\t});\n}\n","createdAt":"2021-09-23T14:33:20.002Z","createdBy":"dQ5F7TLrsV8wRP5kjnkoom","previewWebhookUrl":"https://platform.segmentapis.com/webhook?n=frid2j8ibivfljixvlv7xiiz387kody1&s=4Fnj5sFR&t=1632407566&w=wMBaUuD1kyoxfqKZzLNPN5","settings":[],"buildpack":"boreal","deployedAt":"2021-09-23T14:33:20Z","catalogId":"TNhNLzGwpl","batchMaxCount":0,"isLatestVersion":true,"resourceType":"SOURCE"}}}
